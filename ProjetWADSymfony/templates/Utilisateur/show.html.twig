{% extends 'base.html.twig' %}

{% block title %}Profil Utilisateur {% endblock %}
{% block javascripts %}
    {{ parent() }}
    {# {{ encore_entry_script_tags ('Prodil') }} #}
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    {# {{ encore_entry_link_tags ('showRecette') }}		 #}
{% endblock %}

{% block body %}
<main class="pt-16">
<div class="profile-banner relative h-64">
<div class="absolute inset-0 bg-black bg-opacity-30"></div>
<div class="absolute -bottom-16 left-1/2 transform -translate-x-1/2">
<div class="relative">
<img src="{{ asset('uploads/images/' ~ utilisateur.photo) }}" class="w-32 h-32 rounded-full border-4 border-white">
</div>
</div>
</div>
<div class="max-w-7xl mx-auto px-4 pt-24">
<div class="text-center mb-8">
<h1 class="text-2xl font-bold text-gray-900">{{ utilisateur.nom }} {{ utilisateur.prenom }}  </h1>
<p class="text-gray-600">Chef Passionnée • Membre depuis 2023</p>
<div class="flex justify-center items-center space-x-4 mt-4">
<div class="flex items-center space-x-1 text-yellow-400">
<i class="ri-star-fill"></i>
<span class="text-gray-700">4.8</span>
</div>
<span class="text-gray-300">|</span>
<div class="flex items-center space-x-1">
<i class="ri-user-follow-line text-primary"></i>
<span class="text-gray-700">1.2k abonnés</span>
</div>
</div>
</div>
<div class="grid grid-cols-12 gap-6">
<div class="col-span-12">
<div class="flex justify-end mb-6">
<button onclick="openEditProfileModal()" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90 transition-colors flex items-center space-x-2 !rounded-button">
<i class="ri-edit-line"></i>
<span>Modifier le profil</span>
</button>
</div>
<div class="bg-white rounded-lg shadow p-6 mb-6">
<div class="flex items-center justify-between mb-6">
<h2 class="text-lg font-semibold">Mes Recettes Publiées</h2>
<a href="{{ path('app_recette_new') }}" class="text-primary hover:text-primary/90 flex items-center space-x-2">
    <i class="ri-add-line"></i>
    <span>Nouvelle Recette</span>
</a>
</div>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
{% for recette in utilisateur.recettes %}
<div onclick="window.location.href='{{ path('app_recette_show', {'id': recette.id}) }}'"  class="border rounded-lg overflow-hidden">
{# <img src="{{recette.image}}" class="w-full h-48 object-cover"> #}
{% if recette.image starts with 'http' %}
        <img src="{{ recette.image }}" alt="{{ recette.titre }}" class="w-full h-40 object-cover rounded-lg mb-3">
    {% else %}
        <img src="{{ asset('uploads/images/' ~ recette.image) }}" alt="{{ recette.titre }}" class="w-full h-40 object-cover rounded-lg mb-3">
    {% endif %}
<div class="p-4">
<h3 class="font-medium mb-2">{{recette.titre}}</h3>
<div class="flex items-center justify-between text-sm text-gray-500">
<span>Publié le  {{ recette.tempsDePreparation|date('Y-m-d') }}</span>
<div class="flex items-center space-x-2">
<i class="ri-heart-line"></i>
<span>{{ recette.recettesNote|length }}</span>
</div>
</div>
</div>
</div>
{% else %}
    <li class="list-group-item">Aucune activité récente.</li>   
{% endfor %}
</div>
</div>


<div class="bg-white rounded-lg shadow p-6 mb-6">
<h2 class="text-lg font-semibold mb-6">Mes Recettes Favorites</h2>
{# <a href="{{ path('app_utilisateur_favoris', {'id': app.user.id})}}" class="text-primary hover:text-primary/90 flex items-center space-x-2">
    <i class="ri-add-line"></i>
    <span>la liste Favoris</span>
</a> #}
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
 {% for recette in utilisateur.FavorisRecette %}
<div onclick="window.location.href='{{ path('app_recette_show', {'id': recette.id}) }}'"  class="border rounded-lg overflow-hidden">
<img src="{{recette.image}}" class="w-full h-48 object-cover">
<div class="p-4">
<h3 class="font-medium mb-2">{{recette.titre}}</h3>
<div class="flex items-center justify-between text-sm text-gray-500">
<span>Par Chef {{recette.utilisateur.nom}} {{recette.utilisateur.prenom}}</span>
<button class="text-primary hover:text-primary/90">
<i class="ri-heart-fill"></i>
</button>
</div>
</div>
</div>
{% else %}
    <li class="list-group-item">Aucune recettes favoris.</li>   
{% endfor %}
</div>
</div>
<div class="bg-white rounded-lg shadow p-6">
<div class="flex items-center justify-between mb-6">
<h2 class="text-lg font-semibold">Ma Liste de Courses</h2>
<button class="text-primary hover:text-primary/90 flex items-center space-x-2" onclick="addShoppingItem()">
<i class="ri-add-line"></i>
<span>Ajouter un article</span>
</button>
</div>
<div class="space-y-4" id="shoppingList">
 {% for ingredient in utilisateur.listCourses %}
<div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
<div class="flex items-center space-x-3">
<input type="checkbox" class="rounded text-primary focus:ring-primary">
<span> {{ingredient.detailsCourses.nom}} ({{ingredient.detailsCourses.quantite}})</span>
</div>
<button class="text-gray-400 hover:text-gray-600" onclick="removeShoppingItem(this)">
<i class="ri-delete-bin-line"></i>
</button>
</div>
{% endfor %}

</div>
</div>
</div>
</div>
</main>

<script>
function toggleUserMenu() {
const menu = document.getElementById('userMenu');
menu.classList.toggle('hidden');
}
document.addEventListener('click', function(event) {
const menu = document.getElementById('userMenu');
const button = event.target.closest('button');
if (!button && !menu.contains(event.target)) {
menu.classList.add('hidden');
}
});
function openEditProfileModal() {
  fetch('/Utilisateur/edit')
    .then(response => response.text())
    .then(html => {
      const modalOverlay = document.createElement('div');
      modalOverlay.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
      modalOverlay.id = 'editProfileModal';
      modalOverlay.innerHTML = html;
      document.body.appendChild(modalOverlay);

      // Gérer la soumission du formulaire
      document.getElementById('editProfileForm').addEventListener('submit', function(e) {
        e.preventDefault();
        closeEditProfileModal();
        showSuccessMessage('Profil mis à jour avec succès');
      });
    })
    .catch(error => {
      console.error('Erreur lors du chargement du modal :', error);
    });
}

function closeEditProfileModal() {
  const modal = document.getElementById('editProfileModal');
  if (modal) modal.remove();
}

function addShoppingItem() {
const modal = document.createElement('div');
modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
modal.innerHTML = `
<div class="bg-white rounded-lg p-6 w-full max-w-md">
<div class="flex justify-between items-center mb-6">
<h3 class="text-lg font-semibold">Ajouter un article</h3>
<button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
<i class="ri-close-line text-xl"></i>
</button>
</div>
<form id="addItemForm" class="space-y-4">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Article</label>
<input type="text" placeholder="Nom de l'article" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">Quantité</label>
<input type="text" placeholder="Ex: 500g, 2L, 3 pièces" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
</div>
<div class="flex justify-end space-x-3">
<button type="submit" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90 !rounded-button">Ajouter</button>
<button type="button" onclick="this.closest('.fixed').remove()" class="px-4 py-2 text-gray-600 hover:text-gray-800 !rounded-button">Annuler</button>
</div>
</form>
</div>
`;
document.body.appendChild(modal);
document.getElementById('addItemForm').addEventListener('submit', function(e) {
e.preventDefault();
const shoppingList = document.getElementById('shoppingList');
const newItem = document.createElement('div');
newItem.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';
newItem.innerHTML = `
<div class="flex items-center space-x-3">
<input type="checkbox" class="rounded text-primary focus:ring-primary">
<span>${e.target.elements[0].value} (${e.target.elements[1].value})</span>
</div>
<button class="text-gray-400 hover:text-gray-600" onclick="removeShoppingItem(this)">
<i class="ri-delete-bin-line"></i>
</button>
`;
shoppingList.prepend(newItem);
modal.remove();
showSuccessMessage('Article ajouté à la liste');
});
}
function removeShoppingItem(button) {
button.closest('.flex').remove();
showSuccessMessage('Article supprimé de la liste');
}
</script>
{% endblock %}
