{# templates/gestion_recettes/afficherRecettes.html.twig #}

{% extends 'base.html.twig' %}

{% block title %}Liste des Recettes{% endblock %}

{% block body %}
    <h1>Liste des Recettes</h1>

    {# Button pour afficher les saisons #}
<button id="showSaisonsBtn">SAISON</button>
<div id="saison" style="display:none;">  {# Ajout d'un style pour masquer par défaut #}
    {% for saison in saisons %}
        <a href="#" class="saison-link" data-valeur="{{ saison.value }}">{{ saison.value }}</a>
    {% endfor %}
</div>

{# Button pour afficher les types de plats #}
<button id="showPlatsBtn">TYPE DE PLAT</button>
<div id="typeDePlat" style="display:none;"> 
    {% for typeDePlat in typeDePlats %} 
        <a href="#" class="typeDePlat-link" data-valeur="{{ typeDePlat.value }}">{{ typeDePlat.value }}</a>
    {% endfor %}
</div>

    {# Button pour afficher les Origines #}
<button id="showOriginesBtn">ORIGINE</button>

<div id="origine" style="display:none;">
    {% for origine in origines %} 
        <a href="#" class="origine-link" data-valeur="{{ origine.value }}">{{ origine.value }}</a>
    {% endfor %}
</div>

   {# Button pour afficher les preparations #}
<button id="showPreparationsBtn">preparation</button>
<div id="preparation" style="display:none;">  {# Ajout d'un style pour masquer par défaut #}
    {% for preparation in preparations %}
        <a href="#" class="preparation-link" data-valeur="{{ preparation.value }}">{{ preparation.value }}</a>
    {% endfor %}
</div>



   <div id="divResultats">
        {% if recettes %}
            <ul>
                {% for recette in recettes %}
                    <li class="recette-item">
                        <h2>{{ recette.titre }}</h2>
                        <h3>{{ recette.utilisateur.nom }}  {{ recette.utilisateur.prenom }}</h3> 
                        <p><strong>Description :</strong> {{ recette.description }}</p>
                        <p><strong>Date de publication :</strong> {{ recette.datePublication|date('d-m-Y') }}</p>
                        <p><strong>Temps de préparation :</strong> {{ recette.tempsDePreparation |date('H:i:s')}} minutes</p>
                        <p><strong>Temps de cuisson :</strong> {{ recette.tempsDeCuison|date('H:i:s') }} minutes</p>
                        <p><strong>Difficulté :</strong> {{ recette.difficulte }}/5</p>
                        <p><strong>Saison :</strong> {{ recette.Saison.value }}</p>
                    

                        <img src="{{ recette.image }}" alt="Image de la recette" class="recette-image">
                        {% if recette.recetteCom %}
                            {% for commentaire in recette.recetteCom %}
                               <p> {{ commentaire.contenu }}  </p>                          
                            {% endfor %}
                        {% endif %}
                        {% if recette.recettesNote %}
                            {% for note in recette.recettesNote %}
                                <p>{{ note.valeur }} </p>                           
                            {% endfor %}
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>  
        {% endif %}
    </div> 


    
    <script>
    function setupSaisonRecetteHandler({ LinkSelector, divResultatsId, showBtnId, ListId }) {
    const links = document.querySelectorAll(LinkSelector);
    const divResultats = document.getElementById(divResultatsId);
    const showBtn = document.getElementById(showBtnId);
    const list = document.getElementById(ListId);

    // Gérer l'affichage des listes (saison/type de plat/origines)
    showBtn.addEventListener('click', function () {
        if (list.style.display === "none" || list.style.display === "") {
            list.style.display = "block";  // Afficher la liste
        } else {
            list.style.display = "none";  // Masquer la liste
        }
    });

    // Gérer les clics sur les liens
    links.forEach(function (link) {
        link.addEventListener('click', function (event) {
            event.preventDefault();  // Empêcher le comportement par défaut du lien

            let valeur = this.getAttribute('data-valeur') || '';  
        
               // Vider le contenu précédent et afficher un message de chargement
            divResultats.innerHTML = '<p>Chargement des recettes...</p>';

            let idParent = event.target.parentElement.id;

            // Construire l'URL en fonction des filtres (saison et/ou type de plat)
            let url = '/gestion/recettes/afficher';
            url += `/${idParent}/${valeur}`;  // Seule la saison

            console.log(url);

            // Utiliser Axios pour faire une requête AJAX
            axios.get(url).then(response => {
                    const recettes = response.data;  // Données en JSON
                    divResultats.innerHTML = '';  // Vider le contenu précédent

                    // Vérifier si des recettes sont trouvées
                    if (recettes.length > 0) {
                        recettes.forEach(recette => {
                            const recetteItem = document.createElement('div');
                            recetteItem.classList.add('recette-item');

                            recetteItem.innerHTML = `<img src="${recette.image}" alt="Image de la recette" class="recette-image">
                            <h2>${recette.titre}</h2>
                            <h3>${recette.utilisateur.nom}</h3>`;
                            

                            divResultats.appendChild(recetteItem);
                        });
                    } else {
                        divResultats.innerHTML = '<p>Aucune recette trouvée pour cette sélection.</p>';
                    }
                })
                .catch(error => {
                    console.error('Erreur lors de la requête:', error);
                    divResultats.innerHTML = '<p>Une erreur est survenue lors du chargement des recettes.</p>';
                });
        });
    });
}


setupSaisonRecetteHandler({LinkSelector: '.saison-link',divResultatsId: 'divResultats',showBtnId: 'showSaisonsBtn',ListId: 'saison'});
setupSaisonRecetteHandler({LinkSelector: '.typeDePlat-link',divResultatsId: 'divResultats',showBtnId: 'showPlatsBtn',ListId: 'typeDePlat'});
setupSaisonRecetteHandler({LinkSelector: '.origine-link',divResultatsId: 'divResultats',showBtnId: 'showOriginesBtn',ListId: 'origine'});
setupSaisonRecetteHandler({LinkSelector: '.preparation-link',divResultatsId: 'divResultats',showBtnId: 'showPreparationsBtn',ListId: 'preparation'});


    </script>
{% endblock %}

