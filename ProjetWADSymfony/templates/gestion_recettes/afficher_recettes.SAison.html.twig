{# templates/gestion_recettes/afficherRecettes.html.twig #}

{% extends 'base.html.twig' %}

{% block title %}Liste des Recettes{% endblock %}
{% block body %}

      <button id="showSeasonsBtn">Afficher les saisons</button>

   <div id="saisonLinks">
        {% for saison in saisons %}
            <a href="#" class="saison-link" data-saison="{{ saison.value }}">{{ saison.value }}</a>
        {% endfor %}
    </div>

    <!-- Div où les résultats des recettes seront affichés -->
    <div id="divResultats" class="recettes-container">
    </div>

   <script>
       
            const saisonLinks = document.querySelectorAll('.saison-link');
            const divResultats = document.getElementById('divResultats');
             const showSeasonsBtn = document.getElementById('showSeasonsBtn');
            const saisonList = document.getElementById('saisonLinks');

            showSeasonsBtn.addEventListener('click', function() {
                if (saisonList.style.display === "none" || saisonList.style.display === "") {
                    saisonList.style.display = "block"; // Afficher la liste des saisons
                } else {
                    saisonList.style.display = "none"; // Masquer la liste des saisons
                }
            });

            saisonLinks.forEach(function(link) {
                link.addEventListener('click', function(event) {
                    event.preventDefault();  // Empêcher le comportement par défaut du lien

                    let saisonValue = this.getAttribute('data-saison');  // Récupérer la valeur de la saison cliquée

                    // Vider le contenu précédent et afficher un message de chargement
                    divResultats.innerHTML = '<p>Chargement des recettes...</p>';

                    // Utiliser Axios pour faire une requête AJAX
                    axios.get(`/gestion/recettes/afficher/${saisonValue}`)
                    .then(response => {
                        // Récupérer les recettes depuis la réponse
                        const recettes = response.data;  // Données déjà en JSON grâce à JsonResponse

                        divResultats.innerHTML = '';

                        // Vérifier si des recettes sont trouvées
                        if (recettes.length > 0) {
                            recettes.forEach(recette => {
                                const recetteItem = document.createElement('div');
                                recetteItem.classList.add('recette-item');

                                recetteItem.innerHTML = `<h2>${recette.titre}</h2>
                                    <h3>${recette.utilisateur.nom}</h3>
                                    <img src="${recette.image}" alt="Image de la recette" class="recette-image">`;

                                divResultats.appendChild(recetteItem);
                            });
                        } else {
                            divResultats.innerHTML = '<p>Aucune recette trouvée pour cette saison.</p>';
                        }
                    })
                    .catch(error => {
                        console.error('Erreur lors de la requête:', error);
                        divResultats.innerHTML = '<p>Une erreur est survenue lors du chargement des recettes.</p>';
                    });
                });
            });
       
    </script>

{% endblock %}

